<%- include('./includes/head.ejs') %>
    <link rel="stylesheet" href="/css/forms.css">
    <link rel="stylesheet" href="/css/product.css">
    </head>

    <body>
        <%- include('./includes/navigation.ejs') %>

            <main>
                <% if (errorMessage) { %>
                    <div class="alert alert-danger">
                        <%= errorMessage %>
                    </div>
                <% } %>
                
                <form class="product-form"
                    action="/admin/<% if (editing) { %>edit-product<% } else { %>add-product<% } %>" 
                    method="POST"
                    enctype="multipart/form-data">
                    
                    <div class="form-control">
                        <label for="title">Tên sản phẩm</label>
                        <input 
                            class="<%= validationErrors.find(e => e.param === 'title') ? 'invalid' : '' %>"
                            type="text" 
                            name="title" 
                            id="title"
                            value="<% if (editing || hasError) { %><%= product.title %><% } %>">
                    </div>

                    <div class="form-control">
                        <label for="image">Hình ảnh sản phẩm</label>
                        <input 
                            type="file" 
                            name="image" 
                            id="image"
                            accept="image/*"
                            <% if (!editing) { %>required<% } %>>
                        <small class="form-text text-muted">Chọn file hình ảnh từ máy tính của bạn</small>
                        <% if (validationErrors.find(e => e.param === 'image')) { %>
                            <div class="invalid-feedback d-block">
                                <%= validationErrors.find(e => e.param === 'image').msg %>
                            </div>
                        <% } %>
                        <% if (editing && product.imgUrl) { %>
                            <div class="mt-3">
                                <p>Hình ảnh hiện tại:</p>
                                <img src="<%= product.imgUrl %>" alt="Current Image" class="img-thumbnail" style="max-width: 200px;">
                            </div>
                        <% } %>
                    </div>

                    <div class="form-control">
                        <label for="price">Giá (VNĐ)</label>
                        <input 
                            class="<%= validationErrors.find(e => e.param === 'price') ? 'invalid' : '' %>"
                            type="number" 
                            name="price" 
                            id="price" 
                            min="0"
                            value="<% if (editing || hasError) { %><%= product.price %><% } %>">
                        <small class="form-text text-muted">Nhập số nguyên, không cần nhập dấu phẩy hoặc chấm</small>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" name="isKg" id="isKg" value="1" <%= product && product.isKg ? 'checked' : '' %>>
                            <label class="form-check-label" for="isKg">Đơn vị tính: kg</label>
                        </div>
                    </div>

                    <div class="form-control">
                        <label for="stock">Số lượng tồn kho</label>
                        <input type="number" name="stock" id="stock" min="0" value="<% if (editing || hasError) { %><%= product.stock %><% } else { %>0<% } %>">
                    </div>

                    <div class="form-control">
                        <label for="description">Mô tả</label>
                        <textarea 
                            class="<%= validationErrors.find(e => e.param === 'description') ? 'invalid' : '' %>"
                            name="description" 
                            id="description"
                            rows="5"><% if (editing || hasError) { %><%= product.description %><% } %></textarea>
                    </div>

                    <div class="form-control">
                        <label for="banner">Thuộc nhóm/Banner</label>
                        <select name="banner" id="banner">
                            <option value="gift" <%= product && product.banner === 'gift' ? 'selected' : '' %>>Quà tặng trái cây</option>
                            <option value="vietnam" <%= product && product.banner === 'vietnam' ? 'selected' : '' %>>Trái cây Việt Nam</option>
                            <option value="import" <%= product && product.banner === 'import' ? 'selected' : '' %>>Trái cây nhập khẩu</option>
                        </select>
                    </div>

                    <% if (editing) { %>
                        <input type="hidden" value="<%= product._id %>" name="productId">
                    <% } %>

                    <button class="btn btn-primary" type="submit">
                        <% if (editing) { %>Cập nhật sản phẩm<% } else { %>Thêm sản phẩm<% } %>
                    </button>
                </form>
            </main>
            <%- include('./includes/end.ejs') %>